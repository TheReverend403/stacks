version: '3.9'

services:
  diun:
    image: crazymax/diun:latest
    container_name: diun
    command: serve
    restart: unless-stopped
    environment:
      DIUN_NOTIF_TELEGRAM_CHATIDS: ${TELEGRAM_CHAT_ID:?}
      DIUN_NOTIF_TELEGRAM_TOKEN: ${TELEGRAM_API_KEY:?}
      DIUN_PROVIDERS_DOCKER: 'true'
      DIUN_WATCH_SCHEDULE: ${DIUN_WATCH_SCHEDULE:-0 */6 * * *}
      DIUN_WATCH_WORKERS: ${DIUN_WATCH_WORKERS:-4}
      LOG_JSON: 'false'
      LOG_LEVEL: info
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - data:/data
    networks:
      - docker-monitoring
    labels:
      - diun.enable=true
      - telegram-notifier.monitor=true

  telegram-notifier:
    image: poma/docker-telegram-notifier:latest
    container_name: telegram-notifier
    restart: unless-stopped
    environment:
      ONLY_WHITELIST: 'true'
      TELEGRAM_NOTIFIER_BOT_TOKEN: ${TELEGRAM_API_KEY:?}
      TELEGRAM_NOTIFIER_CHAT_ID: ${TELEGRAM_CHAT_ID:?}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - docker-monitoring
    labels:
      - diun.enable=true

volumes:
  data:

networks:
  docker-monitoring:
    name: docker-monitoring
